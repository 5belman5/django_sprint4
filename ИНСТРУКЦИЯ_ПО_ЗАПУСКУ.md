# Инструкция по запуску проекта Blogicum

## Шаг 1: Установка зависимостей

### Вариант 1: Создание виртуального окружения (рекомендуется)

```bash
# Перейдите в папку проекта
cd "C:\Users\USER\OneDrive\Рабочий стол\blogicum\django_sprint4\blogicum"
# Или если вы уже в папке django_sprint4:
cd blogicum

# Создайте виртуальное окружение
python -m venv venv

# Активируйте виртуальное окружение
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Установите зависимости
pip install -r requirements.txt
```

### Вариант 2: Установка без виртуального окружения

```bash
pip install -r requirements.txt
```

## Шаг 2: Применение миграций базы данных

```bash
# Убедитесь, что вы в папке blogicum (где находится manage.py)
# Если нет, перейдите:
cd "C:\Users\USER\OneDrive\Рабочий стол\blogicum\django_sprint4\blogicum"

# Примените миграции
python manage.py migrate
```

## Шаг 3: Создание суперпользователя (опционально)

Для доступа к административной панели Django:

```bash
python manage.py createsuperuser
```

Введите имя пользователя, email и пароль.

## Шаг 4: Запуск сервера разработки

```bash
python manage.py runserver
```

Сервер запустится на `http://127.0.0.1:8000/`

## Шаг 5: Открытие в браузере

Откройте браузер и перейдите по адресу:
- Главная страница: http://127.0.0.1:8000/
- Админ-панель: http://127.0.0.1:8000/admin/
- О проекте: http://127.0.0.1:8000/pages/about/
- Правила: http://127.0.0.1:8000/pages/rules/

## Дополнительные команды

### Создание миграций (если изменили модели)

```bash
python manage.py makemigrations
python manage.py migrate
```

### Запуск тестов

Проект использует **pytest** для тестирования. Все тесты находятся в папке `tests/`.

#### Базовый запуск всех тестов

```bash
# Перейдите в папку django_sprint4 (где находится pytest.ini)
cd "C:\Users\USER\OneDrive\Рабочий стол\blogicum\django_sprint4"

# Убедитесь, что установлены все зависимости (включая pytz)
pip install -r requirements.txt

# Запустите все тесты
pytest
```

**Важно:** Перед запуском тестов убедитесь, что установлены все зависимости, включая `pytz`, который необходим для работы тестов.

#### Запуск конкретного тестового файла

```bash
# Запуск тестов постов
pytest tests/test_post.py

# Запуск тестов комментариев
pytest tests/test_comment.py

# Запуск тестов пользователей
pytest tests/test_users.py

# Запуск тестов контента
pytest tests/test_content.py
```

#### Запуск конкретного теста

```bash
# Запуск конкретной тестовой функции
pytest tests/test_post.py::test_post_created_at

# Запуск тестового класса
pytest tests/test_content.py::TestContent
```

#### Запуск с подробным выводом

```bash
# Подробный вывод (-v или -vv)
pytest -v
pytest -vv

# Показать вывод print() в тестах
pytest -s

# Показать вывод и подробности
pytest -vv -s
```

#### Запуск с покрытием кода (если установлен pytest-cov)

```bash
pytest --cov=blogicum --cov-report=html
```

#### Остановка после первой ошибки

```bash
pytest -x
```

#### Запуск только упавших тестов

```bash
pytest --lf
```

#### Полезные опции

```bash
# Показать 10 самых медленных тестов
pytest --durations=10

# Запустить тесты в параллель (если установлен pytest-xdist)
pytest -n auto

# Показать локальные переменные при ошибке
pytest -l
```

#### Структура тестов

```
tests/
├── test_post.py          # Тесты постов (4 теста)
├── test_comment.py        # Тесты комментариев (4 теста)
├── test_users.py          # Тесты пользователей (2 теста)
├── test_content.py        # Тесты контента (7 тестов)
├── test_static_pages.py   # Тесты статических страниц (1 тест)
├── test_err_pages.py      # Тесты страниц ошибок (2 теста)
├── test_emails.py         # Тесты email (2 теста)
└── conftest.py            # Фикстуры и вспомогательные функции
```

**Всего в проекте: 25 тестов**

#### Пример вывода успешного запуска

```bash
$ pytest
======================== test session starts =========================
platform win32 -- Python 3.14.0, pytest-9.0.2, pytest-django-4.11.1
Django settings: blogicum.settings (from ini file)
collected 25 items

tests/test_post.py::TestPostModelAttrs::test_model_attrs[image field] PASSED
tests/test_post.py::TestPostModelAttrs::test_model_attrs[pub_date field] PASSED
tests/test_post.py::test_post_created_at PASSED
tests/test_post.py::test_post PASSED
... (остальные тесты)

======================== 25 passed in 15.23s =========================
```

### Сбор статических файлов (для продакшена)

```bash
python manage.py collectstatic
```

## Структура проекта

```
blogicum/
├── blogicum/          # Настройки проекта
├── blog/              # Приложение блога
├── pages/             # Статические страницы
├── templates/         # HTML шаблоны
├── static_dev/        # Статические файлы
├── media/             # Загруженные файлы
└── manage.py          # Утилита управления
```

## Решение проблем

### Ошибка: "No module named 'django'"
- Убедитесь, что установлены все зависимости: `pip install -r requirements.txt`
- Проверьте, что виртуальное окружение активировано

### Ошибка: "django.db.utils.OperationalError: no such table"
- Примените миграции: `python manage.py migrate`

### Ошибка: "Port 8000 is already in use"
- Используйте другой порт: `python manage.py runserver 8001`

### Ошибка: "ModuleNotFoundError: No module named 'pytz'"
- Установите недостающий модуль: `pip install pytz`
- Или переустановите все зависимости: `pip install -r requirements.txt`

### Ошибка: "Not Found: /accounts/profile/" после входа
- Эта проблема исправлена в настройках проекта
- После входа пользователь перенаправляется на главную страницу (`/`)
- Если ошибка все еще появляется, перезапустите сервер разработки

### Ошибка: "Method Not Allowed (GET): /auth/logout/"
- Выход из системы должен выполняться через POST-запрос
- Используйте форму выхода или кнопку в интерфейсе, а не прямой GET-запрос

